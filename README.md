# -# 批量删除图片黑色背景工具

这是一个专门用于批量删除JPG格式图片中纯黑背景的工具，支持命令行和图形界面两种使用方式。

## 功能特点

- ✅ 批量处理JPG格式图片
- ✅ 智能识别纯黑背景并转换为透明背景
- ✅ 保持图片清晰度，无损处理
- ✅ 支持递归处理子目录
- ✅ 提供命令行和图形界面两种使用方式
- ✅ 实时显示处理进度
- ✅ 自动创建输出目录结构

## 安装依赖

确保已安装以下Python包：

```bash
pip install Pillow numpy tqdm PyQt5
```

或者使用项目中的requirements.txt：

```bash
pip install -r requirements.txt
```

## 使用方法

### 方法一：图形界面（推荐）

运行图形界面版本：

```bash
python bg_removal_gui.py
```

**操作步骤：**

1. **选择输入目录**：点击"浏览..."按钮选择包含JPG图片的目录
2. **选择输出目录**（可选）：如果不选择，会在输入目录下创建`processed`文件夹
3. **调整参数**：
   - **黑色阈值**：低于此值的像素被认为是黑色背景（默认30）
   - **图片质量**：输出图片质量1-100（默认95）
   - **递归处理子目录**：是否处理子文件夹中的图片
   - **文件扩展名**：要处理的文件类型（默认.jpg, .jpeg）
4. **开始处理**：点击"开始处理"按钮
5. **查看结果**：处理完成后会显示统计信息

### 方法二：命令行

运行命令行版本：

```bash
python batch_bg_removal.py <输入目录> [选项]
```

**基本用法：**

```bash
# 处理指定目录下的所有JPG图片
python batch_bg_removal.py /path/to/images

# 指定输出目录
python batch_bg_removal.py /path/to/images -o /path/to/output

# 调整黑色阈值（默认30）
python batch_bg_removal.py /path/to/images -t 50

# 设置输出质量（默认95）
python batch_bg_removal.py /path/to/images -q 90

# 不递归处理子目录
python batch_bg_removal.py /path/to/images --no-recursive

# 处理特定扩展名的文件
python batch_bg_removal.py /path/to/images --extensions .jpg .jpeg .png
```

**命令行参数说明：**

- `input_dir`：输入目录路径（必需）
- `-o, --output`：输出目录路径（可选）
- `-t, --threshold`：黑色阈值，1-255（默认30）
- `-q, --quality`：输出图片质量，1-100（默认95）
- `--no-recursive`：不递归处理子目录
- `--extensions`：要处理的文件扩展名（默认.jpg .jpeg）

## 处理原理

1. **背景识别**：扫描图片中的每个像素，识别RGB值都低于阈值的像素作为黑色背景
2. **透明度处理**：将识别出的黑色背景像素的Alpha通道设为0（透明）
3. **格式转换**：由于JPG不支持透明度，输出格式自动转换为PNG
4. **质量保持**：使用高质量算法处理，保持图片清晰度

## 输出说明

- 处理后的图片会保存为PNG格式（支持透明度）
- 保持原有的目录结构
- 如果输出目录未指定，会在输入目录下创建`processed`文件夹
- 处理过程中会显示实时进度和统计信息

## 注意事项

1. **备份原图**：建议在处理前备份原始图片
2. **存储空间**：PNG格式文件通常比JPG大，确保有足够的存储空间
3. **处理时间**：大量图片处理可能需要较长时间，请耐心等待
4. **黑色阈值**：如果图片中有深灰色但不是纯黑的部分，可以适当调整阈值

## 故障排除

**Q: 处理后的图片背景没有变透明？**
A: 检查黑色阈值设置，可能需要调高阈值以识别更深的灰色

**Q: 处理速度很慢？**
A: 大图片处理需要更多时间，可以尝试降低输出质量设置

**Q: 程序报错"找不到模块"？**
A: 请确保已安装所有依赖包：`pip install Pillow numpy tqdm PyQt5`

**Q: 处理后的图片质量下降？**
A: 检查图片质量设置，建议设置为90-95之间

## 技术细节

- 使用PIL（Pillow）进行图像处理
- 使用NumPy进行高效的像素操作
- 支持多线程处理（GUI版本）
- 自动处理文件路径和目录结构
- 错误处理和进度显示

## 更新日志

- v1.0：初始版本，支持基本的黑色背景删除功能
- 支持命令行和图形界面两种使用方式
- 支持批量处理和进度显示
